(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6250],{2689:(e,a,t)=>{Promise.resolve().then(t.bind(t,6717))},6717:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i});var r=t(5155),l=t(2115);let s=e=>(Number(e)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),d=e=>e?new Date(e).toLocaleString("pt-BR",{timeZone:"America/Cuiaba",dateStyle:"short",timeStyle:"short"}):"-",n=e=>{let a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(a,"-").concat(t,"-").concat(r)},o=e=>{let a=(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())})();if("today"===e)return{from:n(a),to:n(a)};if("7d"===e){let e=new Date(a);return e.setDate(e.getDate()-6),{from:n(e),to:n(a)}}if("30d"===e){let e=new Date(a);return e.setDate(e.getDate()-29),{from:n(e),to:n(a)}}return"month"===e?{from:n((e=>new Date(e.getFullYear(),e.getMonth(),1))(a)),to:n(a)}:null},c=[{key:"today",label:"Hoje"},{key:"7d",label:"\xdaltimos 7 dias"},{key:"30d",label:"\xdaltimos 30 dias"},{key:"month",label:"Este m\xeas"},{key:"custom",label:"Personalizado"}],x=[{key:"all",label:"Todos"},{key:"pago",label:"Pago"},{key:"pendente",label:"Pendente"},{key:"expirado",label:"Expirado"}];function i(){var e;let a=o("30d"),[t,n]=(0,l.useState)("30d"),[i,p]=(0,l.useState)(a.from),[m,g]=(0,l.useState)(a.to),[u,h]=(0,l.useState)("all"),[y,b]=(0,l.useState)(""),[j,f]=(0,l.useState)(""),[N,k]=(0,l.useState)(null),[v,w]=(0,l.useState)(!0),[S,D]=(0,l.useState)(""),[C,P]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=setTimeout(()=>f(y),300);return()=>clearTimeout(e)},[y]);let A=(0,l.useMemo)(()=>{let e=new URLSearchParams({from:i,to:m});return j&&e.set("q",j),"all"!==u&&e.set("status",u),"/api/pagamentos?".concat(e.toString())},[i,m,j,u]);return(0,l.useEffect)(()=>{let e=!1;return(async()=>{w(!0),D("");try{let a=await fetch(A,{cache:"no-store"});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Falha ao carregar pagamentos")}let t=await a.json();e||k(t)}catch(a){e||D(a.message||"Erro ao carregar pagamentos")}finally{e||w(!1)}})(),()=>{e=!0}},[A]),(0,r.jsxs)("div",{className:"p-6 md:p-8 bg-[#F0F6FA] dark:bg-[#1a2233] min-h-screen transition-colors",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-6",children:"Hist\xf3rico de Pagamentos"}),(0,r.jsxs)("div",{className:"mb-6 flex flex-col gap-3 md:gap-4 md:flex-row md:items-end md:justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:items-end",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Per\xedodo"}),(0,r.jsx)("select",{value:t,onChange:e=>(function(e){if(n(e),"custom"!==e){let a=o(e);a&&(p(a.from),g(a.to))}})(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100",children:c.map(e=>(0,r.jsx)("option",{value:e.key,children:e.label},e.key))})]}),"custom"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"De"}),(0,r.jsx)("input",{type:"date",value:i,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"At\xe9"}),(0,r.jsx)("input",{type:"date",value:m,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100"})]}),(0,r.jsx)("button",{onClick:function(){return i&&m?i>m?alert("A data inicial n\xe3o pode ser maior que a final."):void(P(!0),setTimeout(()=>P(!1),150)):alert("Selecione as duas datas.")},disabled:C,className:"h-[40px] self-end px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md disabled:opacity-60",children:C?"Aplicando...":"Aplicar"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:items-end",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Status"}),(0,r.jsx)("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100",children:x.map(e=>(0,r.jsx)("option",{value:e.key,children:e.label},e.key))})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("label",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Buscar"}),(0,r.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"Descri\xe7\xe3o, plano, MAC, IP, roteador...",className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100 min-w-[260px]"})]}),(0,r.jsx)("button",{onClick:function(){let e=(null==N?void 0:N.itens)||[];if(!e.length)return alert("Nada para exportar.");let a=new Blob([[["ID","Descri\xe7\xe3o","Plano","Valor","Status","Data","Forma","MAC","IP","Roteador"],...e.map(e=>{var a,t,r,l,s;return[e.id,(null!=(a=e.descricao)?a:"").replaceAll('"','""'),(null!=(t=e.plano)?t:"").replaceAll('"','""'),(Number(e.valor)||0).toFixed(2).replace(".",","),e.status,d(e.data),e.forma,null!=(r=e.mac)?r:"",null!=(l=e.ip)?l:"",null!=(s=e.roteador)?s:""]})].map(e=>e.map(e=>'"'.concat(String(e),'"')).join(";")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(a),t.download="pagamentos_".concat(i,"_a_").concat(m,".csv"),t.click(),URL.revokeObjectURL(t.href)},className:"h-[40px] self-end bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md",children:"Exportar CSV"})]})]}),(null==N?void 0:N.periodo)&&(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:["Per\xedodo: ",(0,r.jsx)("b",{children:N.periodo.from})," → ",(0,r.jsx)("b",{children:N.periodo.to})," • ",N.periodo.days," dia(s)",(null==N?void 0:N.resumo)&&(0,r.jsxs)(r.Fragment,{children:[" • ",N.resumo.qtdPagos," pagos (",s(N.resumo.totalPagos),"), ",N.resumo.qtdPendentes," pendentes, ",N.resumo.qtdExpirados," expirados"]})]}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-xl shadow bg-white dark:bg-[#232e47] transition-colors",children:(0,r.jsxs)("table",{className:"min-w-full text-sm text-left text-gray-700 dark:text-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-100 dark:bg-[#1a2233] text-gray-700 dark:text-gray-300 uppercase text-xs",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"Descri\xe7\xe3o"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Plano"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Valor"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Forma"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Data"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"MAC"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"IP"}),(0,r.jsx)("th",{className:"px-4 py-3 text-center",children:"A\xe7\xf5es"})]})}),(0,r.jsx)("tbody",{children:v?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:9,className:"px-4 py-6 text-center text-gray-500",children:"Carregando..."})}):(null==N||null==(e=N.itens)?void 0:e.length)?N.itens.map(e=>(0,r.jsxs)("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("td",{className:"px-4 py-2",children:e.descricao||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.plano||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:s(e.valor)}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.forma}),(0,r.jsx)("td",{className:"px-4 py-2",children:d(e.data)}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-white text-xs\n                      ".concat("pago"===e.status?"bg-green-600":"pendente"===e.status?"bg-yellow-500":"expirado"===e.status?"bg-red-600":"bg-gray-500"),children:e.status})}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.mac||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.ip||"-"}),(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:(0,r.jsx)("button",{className:"text-blue-600 dark:text-blue-400 hover:underline text-sm",onClick:()=>alert(JSON.stringify(e,null,2)),children:"Ver Detalhes"})})]},e.id)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:9,className:"px-4 py-6 text-center text-gray-400 dark:text-gray-500",children:"Nenhum pagamento encontrado."})})})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=2689)),_N_E=e.O()}]);