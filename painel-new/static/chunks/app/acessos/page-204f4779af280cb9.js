(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3414],{8775:(e,t,a)=>{Promise.resolve().then(a.bind(a,9575))},9575:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(5155),s=a(2115);function n(e){let t=new Date(e),a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(s)}function o(e,t){let a=new Date(e);return a.setDate(a.getDate()+t),a}function c(){let[e,t]=(0,s.useState)("24h"),[a,c]=(0,s.useState)(""),[l,i]=(0,s.useState)([]),[d,x]=(0,s.useState)(!0),[m,p]=(0,s.useState)(!0),[h,u]=(0,s.useState)(null),{from:g,to:y}=(0,s.useMemo)(()=>{let t=new Date,a=o(t,-1);switch(e){case"hoje":{let e=new Date;e.setHours(0,0,0,0),a=e;break}case"semana":a=o(t,-7);break;case"mes":a=o(t,-30);break;default:a=o(t,-1)}return{from:a,to:t}},[e]),b=(0,s.useRef)(!1);async function j(e){try{var t,a;if(b.current)return;b.current=!0,x(!0);let r=new URLSearchParams;r.set("from",n(g)),r.set("to",n(y));let s=await fetch("/api/sessoes?".concat(r.toString()),{cache:"no-store",signal:e}),o=await s.json().catch(()=>({})),c=Array.isArray(o)?o:null!=(a=null!=(t=o.items)?t:o.data)?a:[];if(Array.isArray(c)){let e=new Date,t=c.map(t=>{let a=t.inicioEm?new Date(t.inicioEm):null,r=t.expiraEm?new Date(t.expiraEm):null,s=!!t.ativo&&(!r||r>e),n=a?(e-a)/6e4:null;return{id:t.id,nome:t.nome||t.macCliente||t.ipCliente||"—",ip:"".concat(t.ipCliente||"—").concat(t.macCliente?" / ".concat(t.macCliente):""),plano:t.plano||"—",tempo:s&&null!=n?function(e){if(null==e)return"—";let t=Math.floor(e/60),a=Math.max(0,Math.round(e-60*t));return t<=0?"".concat(a," min"):a<=0?"".concat(t," h"):"".concat(t," h ").concat(a," min")}(n):"—",status:s?"Ativo":r&&r<=e?"Expirado":"Inativo"}});i(t),u(new Date)}else i([])}catch(e){(null==e?void 0:e.name)!=="AbortError"&&(console.error("Erro ao carregar sess\xf5es:",e),i([]))}finally{b.current=!1,x(!1)}}(0,s.useEffect)(()=>{let e=new AbortController;return j(e.signal),()=>e.abort()},[g,y]),(0,s.useEffect)(()=>{if(!m)return;let e=new AbortController,t=setInterval(()=>j(e.signal),15e3);return()=>{e.abort(),clearInterval(t)}},[m,g,y]);let f=(0,s.useMemo)(()=>{let e=a.trim().toLowerCase();return e?l.filter(t=>t.nome.toLowerCase().includes(e)||t.ip.toLowerCase().includes(e)||t.plano.toLowerCase().includes(e)):l},[l,a]);async function w(e){if(confirm("Encerrar esta sess\xe3o agora?"))try{if(!(await fetch("/api/sessoes/".concat(encodeURIComponent(e)),{method:"DELETE"})).ok)throw Error("Falha ao encerrar");i(t=>t.map(t=>t.id===e?{...t,status:"Inativo",tempo:"—"}:t))}catch(e){console.error(e),alert("N\xe3o foi poss\xedvel encerrar a sess\xe3o. Verifique a rota /api/sessoes/:id (DELETE).")}}return(0,r.jsxs)("div",{className:"p-6 md:p-8 bg-[#F0F6FA] dark:bg-[#1a2233] min-h-screen transition-colors",children:[(0,r.jsx)("div",{className:"bg-white dark:bg-[#232e47] rounded-xl p-6 shadow",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Acompanhamento de Acessos"}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[(0,r.jsx)("input",{type:"checkbox",className:"w-4 h-4",checked:m,onChange:e=>p(e.target.checked)}),"Auto-refresh (15s)"]}),(0,r.jsx)("span",{children:"•"}),(0,r.jsx)("span",{children:h?"Atualizado: ".concat(h.toLocaleTimeString()):"—"})]})]})}),(0,r.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-4",children:[(0,r.jsx)("input",{type:"text",placeholder:"Buscar por nome, IP ou plano",value:a,onChange:e=>c(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md w-full md:w-1/3 bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100"}),(0,r.jsxs)("select",{value:e,onChange:e=>t(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-[#232e47] text-gray-800 dark:text-gray-100",children:[(0,r.jsx)("option",{value:"24h",children:"\xdaltimas 24h"}),(0,r.jsx)("option",{value:"hoje",children:"Hoje"}),(0,r.jsx)("option",{value:"semana",children:"Esta semana"}),(0,r.jsx)("option",{value:"mes",children:"Este m\xeas"})]}),(0,r.jsx)("button",{onClick:function(){let e=new Blob([[["Nome","IP / MAC","Plano","Tempo conectado","Status"],...f.map(e=>[e.nome,e.ip,e.plano,e.tempo,e.status])].map(e=>e.map(e=>'"'.concat(String(e).replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="acessos_".concat(n(g),"_").concat(n(y),".csv"),document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(t)},className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md",children:"Exportar CSV"})]}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-xl shadow bg-white dark:bg-[#232e47] transition-colors",children:(0,r.jsxs)("table",{className:"min-w-full text-sm text-left text-gray-700 dark:text-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-100 dark:bg-[#1a2233] text-gray-700 dark:text-gray-300 uppercase text-xs",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"Nome"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"IP / MAC"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Plano"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Tempo Conectado"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Status"}),(0,r.jsx)("th",{className:"px-4 py-3 text-center",children:"A\xe7\xf5es"})]})}),(0,r.jsx)("tbody",{children:d?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-400 dark:text-gray-500",children:"Carregando..."})}):0===f.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"text-center py-6 text-gray-400 dark:text-gray-500",children:"Nenhum acesso registrado."})}):f.map(e=>(0,r.jsxs)("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("td",{className:"px-4 py-2",children:e.nome}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.ip}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.plano}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.tempo}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-white text-xs ".concat("Ativo"===e.status?"bg-green-500":"Expirado"===e.status?"bg-gray-500":"bg-red-500"),children:e.status})}),(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:(0,r.jsx)("button",{onClick:()=>w(e.id),className:"text-red-600 dark:text-red-400 hover:underline text-sm",children:"Encerrar"})})]},e.id))})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=8775)),_N_E=e.O()}]);