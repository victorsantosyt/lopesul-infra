(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9408],{1847:(e,a,t)=>{"use strict";t.d(a,{A:()=>n});var s=t(2115);let r=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},l=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,s.forwardRef)((e,a)=>{let{color:t="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:c="",children:o,iconNode:x,...h}=e;return(0,s.createElement)("svg",{ref:a,...d,width:r,height:r,stroke:t,strokeWidth:n?24*Number(i)/Number(r):i,className:l("lucide",c),...!o&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(h)&&{"aria-hidden":"true"},...h},[...x.map(e=>{let[a,t]=e;return(0,s.createElement)(a,t)}),...Array.isArray(o)?o:[o]])}),n=(e,a)=>{let t=(0,s.forwardRef)((t,d)=>{let{className:n,...c}=t;return(0,s.createElement)(i,{ref:d,iconNode:a,className:l("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),n),...c})});return t.displayName=r(e),t}},3166:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(1847).A)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]])},4455:(e,a,t)=>{Promise.resolve().then(t.bind(t,9426))},9426:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>g});var s=t(5155),r=t(2115),l=t(1847);let d=(0,l.A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),i=(0,l.A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),n=(0,l.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),c=(0,l.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),o=(0,l.A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),x=(0,l.A)("shield-x",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);var h=t(3166);let m=(0,l.A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),p=(0,l.A)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),u=/^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/,y=/^(([0-9a-f]{1,4}:){7}[0-9a-f]{1,4}|(([0-9a-f]{1,4}:){1,7}:)|(([0-9a-f]{1,4}:){1,6}:[0-9a-f]{1,4})|(([0-9a-f]{1,4}:){1,5}(:[0-9a-f]{1,4}){1,2})|(([0-9a-f]{1,4}:){1,4}(:[0-9a-f]{1,4}){1,3})|(([0-9a-f]{1,4}:){1,3}(:[0-9a-f]{1,4}){1,4})|(([0-9a-f]{1,4}:){1,2}(:[0-9a-f]{1,4}){1,5})|([0-9a-f]{1,4}:)((:[0-9a-f]{1,4}){1,6})|:((:[0-9a-f]{1,4}){1,7}|:))(%.+)?$/i;function g(){let[e,a]=(0,r.useState)(!1),[t,l]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null),[b,j]=(0,r.useState)("paid_clients"),[k,N]=(0,r.useState)(100),[v,w]=(0,r.useState)([]),[A,S]=(0,r.useState)([]),[C,M]=(0,r.useState)(null),[P,E]=(0,r.useState)(null),[z,I]=(0,r.useState)(null),L=e||t;function _(e,a){M({type:e,text:a}),setTimeout(()=>M(null),3e3)}async function O(){a(!0);try{let a=await fetch("/api/dispositivos/status",{cache:"no-store"}),s=await a.json();if(a.ok){var e,t;g((null==s||null==(e=s.mikrotik)?void 0:e.lastHost)?"Mikrotik (".concat(s.mikrotik.lastHost,")"):(null==s||null==(t=s.mikrotik)?void 0:t.online)?"Mikrotik":null),w([])}else w([]),_("err",(null==s?void 0:s.error)||"Falha ao carregar status")}catch(e){_("err","Erro de rede ao consultar status")}finally{a(!1)}}async function T(){l(!0);try{let e=await fetch("/api/hotspot/active?limit=".concat(k),{cache:"no-store"}),a=await e.json(),t=Array.isArray(a)?a:Array.isArray(null==a?void 0:a.items)?a.items:[];S(t)}catch(e){_("err","Erro de rede ao consultar PPP/Hotspot ativos"),S([])}finally{l(!1)}}async function F(e){let a;if(a=e||"",!(u.test(a)||y.test(a)))return _("err","IP inv\xe1lido");E(e),I("revogar");try{let a=await fetch("/api/hotspot/kick/by-ip",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({ip:e})}),t=await a.json().catch(()=>({}));a.ok&&(null==t?void 0:t.ok)?(fetch("/api/sessoes/revogar",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({ip:e})}).catch(()=>{}),_("ok","IP ".concat(e," revogado")),await new Promise(e=>setTimeout(e,300)),T()):_("err",(null==t?void 0:t.error)||"Falha ao revogar ".concat(e))}catch(a){_("err","Erro de rede ao revogar ".concat(e))}finally{E(null),I(null)}}async function R(e,a){_("err","Libera\xe7\xe3o manual mudou para o fluxo de pagamento (/api/liberar-acesso).")}(0,r.useEffect)(()=>{O(),T()},[]);let H=v.length,U=A.length;return(0,s.jsxs)("div",{className:"p-6 md:p-8 bg-[#F0F6FA] dark:bg-[#1a2233] min-h-screen transition-colors space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Status do Mikrotik"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Roteador: ",p?(0,s.jsx)("span",{className:"font-semibold",children:p}):"—"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("input",{value:b,onChange:e=>j(e.target.value),className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-slate-900 text-sm",placeholder:"address-list (ex.: paid_clients)"}),(0,s.jsx)("input",{type:"number",min:10,max:500,value:k,onChange:e=>N(Math.max(10,Math.min(500,parseInt(e.target.value||"0",10)))),className:"w-24 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-slate-900 text-sm",placeholder:"Limite"}),(0,s.jsxs)("button",{onClick:()=>{O(),T()},disabled:L,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60 focus:ring-2 focus:ring-blue-400",children:[L?(0,s.jsx)(d,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(i,{className:"h-4 w-4"}),"Atualizar"]})]})]}),C&&(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-lg px-3 py-2 text-sm ".concat("ok"===C.type?"bg-green-600/10 text-green-700 dark:text-green-300 border border-green-600/30":"err"===C.type?"bg-red-600/10 text-red-700 dark:text-red-300 border border-red-600/30":"bg-sky-600/10 text-sky-700 dark:text-sky-300 border border-sky-600/30"),children:["ok"===C.type?(0,s.jsx)(n,{className:"h-4 w-4"}):"err"===C.type?(0,s.jsx)(c,{className:"h-4 w-4"}):(0,s.jsx)(o,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:C.text})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:["Address-list ",(0,s.jsxs)("span",{className:"font-mono text-gray-500",children:["(",b,")"]})]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total: ",H]})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("table",{className:"min-w-[640px] w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"IP"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Coment\xe1rio"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Criado"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Ativo"}),(0,s.jsx)("th",{className:"text-right px-3 py-2",children:"A\xe7\xf5es"})]})}),(0,s.jsx)("tbody",{children:0===v.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"(Sem dados — /api/dispositivos/status n\xe3o retorna address-list)"})}):v.map((e,a)=>{let t=P===e.address&&"revogar"===z;return(0,s.jsxs)("tr",{className:"border-t border-gray-100 dark:border-gray-800",children:[(0,s.jsx)("td",{className:"px-3 py-2 font-mono",children:e.address||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.comment||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.creationTime||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.disabled?"n\xe3o":"sim"}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:(0,s.jsxs)("button",{onClick:()=>e.address&&F(e.address),disabled:!e.address||t,className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 focus:ring-2 focus:ring-red-400",children:[t?(0,s.jsx)(d,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(x,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Revogar"})]})})]},"".concat(e.address,"-").concat(a))})})]})}),(0,s.jsx)(f,{onSubmit:R})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2 text-gray-800 dark:text-white",children:[(0,s.jsx)(h.A,{className:"h-5 w-5"})," PPP Active"]}),(0,s.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total: ",U]})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("table",{className:"min-w-[640px] w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Nome"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"IP"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Caller ID"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Servi\xe7o"}),(0,s.jsx)("th",{className:"text-left px-3 py-2",children:"Uptime"}),(0,s.jsx)("th",{className:"text-right px-3 py-2",children:"A\xe7\xf5es"})]})}),(0,s.jsx)("tbody",{children:0===A.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"text-center py-6 text-gray-500",children:"Nenhuma sess\xe3o ativa."})}):A.map((e,a)=>{let t=(null==e?void 0:e.address)||(null==e?void 0:e.ip)||(null==e?void 0:e.ipAddress)||"",r=(null==e?void 0:e.callerId)||(null==e?void 0:e.mac)||(null==e?void 0:e.caller)||"",l=(null==e?void 0:e.name)||(null==e?void 0:e.user)||(null==e?void 0:e.username)||"—",i=(null==e?void 0:e.service)||(null==e?void 0:e.profile)||"—",n=(null==e?void 0:e.uptime)||(null==e?void 0:e.uptimeStr)||"—",c=P===t&&"revogar"===z;return(0,s.jsxs)("tr",{className:"border-t border-gray-100 dark:border-gray-800",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:l}),(0,s.jsx)("td",{className:"px-3 py-2 font-mono",children:t||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:r||"—"}),(0,s.jsx)("td",{className:"px-3 py-2",children:i}),(0,s.jsxs)("td",{className:"px-3 py-2 flex items-center gap-1",children:[(0,s.jsx)(m,{className:"h-4 w-4"})," ",n]}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:(0,s.jsxs)("button",{onClick:()=>t&&F(t),disabled:!t||c,className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 focus:ring-2 focus:ring-red-400",children:[c?(0,s.jsx)(d,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(x,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Revogar"})]})})]},"".concat(l,"-").concat(t,"-").concat(a))})})]})})]})]})}function f(e){let{onSubmit:a}=e,[t,l]=(0,r.useState)(""),[d,i]=(0,r.useState)(""),n=(0,r.useMemo)(()=>t.trim().length>3,[t]);return(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-stretch md:items-end gap-2 md:gap-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"IP"}),(0,s.jsx)("input",{value:t,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-slate-900",placeholder:"Ex.: 10.0.0.55",inputMode:"decimal"})]}),(0,s.jsxs)("div",{className:"md:w-64",children:[(0,s.jsx)("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"\xd4nibus / Bus ID (opcional)"}),(0,s.jsx)("input",{value:d,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-slate-900",placeholder:"Ex.: BUS-001"})]}),(0,s.jsxs)("div",{className:"md:w-auto",children:[(0,s.jsx)("label",{className:"block text-sm mb-1 invisible md:visible",children:" "}),(0,s.jsxs)("button",{disabled:!n,onClick:()=>n&&a(t.trim(),d.trim()||void 0),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white disabled:opacity-50 focus:ring-2 focus:ring-emerald-400",children:[(0,s.jsx)(p,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Liberar IP"})]})]})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=4455)),_N_E=e.O()}]);